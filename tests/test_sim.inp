* GENERATED BY
*
*

set base /cluster/home/boittier/sims/kmdcm/water/K300

set min 0
set heat 0
set equi 0
set dyna 0
set n 0

!============================================================
! Topology and Parameter Files
!============================================================

! Topology
read rtf card
* methanol
*
31 1

MASS     5  HT        1.00800 H ! TIPS3P WATER HYDROGEN
MASS    75  OT       15.99940 O ! TIPS3P WATER OXYGEN
MASS  1  CG331     12.01100 ! aliphatic C for methyl group (-CH3)
MASS  2  HGP1       1.00800 ! polar H
MASS  3  HGA3       1.00800 ! alphatic proton, CH3
MASS  4  OG311     15.99940 ! hydroxyl oxygen

DEFA FIRS NONE LAST NONE
AUTO ANGLES DIHE PATCH DRUDE

RESI MEO            0.000 ! param penalty=   0.000 ; charge penalty=   0.000
GROUP            ! CHARGE   CH_PENALTY
ATOM O      OG311  -0.650 !    0.000
ATOM C      CG331  -0.040 !    0.000
ATOM H1     HGP1    0.420 !    0.000
ATOM H2     HGA3    0.090 !    0.000
ATOM H3     HGA3    0.090 !    0.000
ATOM H4     HGA3    0.090 !    0.000
BOND C     O
BOND O    H1
BOND C     H4
BOND C     H3
BOND C     H2
PATC  FIRS NONE LAST NONE

RESI TIP3         0.000 ! tip3p water model, generate using noangle nodihedral
GROUP
ATOM O    OT    -0.67597213  !-0.834
ATOM H    HT     0.33798606  ! 0.417
ATOM H1   HT     0.33798606  ! 0.417
BOND O H O H1 H H1    ! the last bond is needed for shake
ANGLE H O H1             ! required
PATCHING FIRS NONE LAST NONE

END



!PARAMETERS
!
!
read parameter card
* methanol
*
ATOMS
MASS     5  HT        1.00800 ! TIPS3P WATER HYDROGEN
MASS    75  OT       15.99940 ! TIPS3P WATER OXYGEN
MASS  1  CG331     12.01100 ! aliphatic C for methyl group (-CH3)
MASS  2  HGP1       1.00800 ! polar H
MASS  3  HGA3       1.00800 ! alphatic proton, CH3
MASS  4  OG311     15.99940 ! hydroxyl oxygen

BONDS
CG331  OG311  428.0     1.420
CG331  HGA3   322.0     1.111
OG311  HGP1   545.0     0.960
OT  HT  1042.0 0.963 ! ALLOW WAT
HT  HT    0.0 1.5139 ! ALLOW WAT

ANGLES
OG311  CG331 HGA3 45.90  108.8900
HGA3   CG331 HGA3 35.50  108.4000
CG331  OG311 HGP1 57.50  106.0000
HT  OT  HT   97.0 104.3 ! ALLOW WAT
OT  HT  HT   97.0 104.3 ! ALLOW WAT

DIHEDRALS
HGA3 CG331 OG311 HGP1     0.18        3     0.0000

IMPROPERS

NONBONDED
OG311    0.0       -0.192   1.765                  ! og MeOH and EtOH 1/06 (was -0.1521 1.7682)
CG331    0.0       -0.078   2.050   0.0 -0.01 1.9 ! alkane (CT3), 4/98, yin, adm jr; Rmin/2 modified from 2.04 to 2.05
HGP1     0.0       -0.046    0.225                 ! polar H
HGA3     0.0       -0.024    1.340                 ! alkane, yin and mackerell, 4/98
OT     0.00  -0.1822  1.7231 ! ALLOW WAT
HT     0.00  -0.1160  0.2500 ! ALLOW WAT
END



!============================================================
! Generate the System
!============================================================

! Read PSF
open read unit 10 card name water.2000.psf
read psf  unit 10 card xplor

! Read Coordinate
open read unit 10 card name water.2000.crd
read coor unit 10 card

!============================================================
! Setup PBC (Periodic Boundary Condition)
!============================================================
coor stat sele all end
calc xdim = int ( ( ?xmax - ?xmin + 0.0 ) ) + 1
calc ydim = int ( ( ?ymax - ?ymin + 0.0 ) ) + 1
calc zdim = int ( ( ?zmax - ?zmin + 0.0 ) ) + 1
set bsiz = 0
if @xdim .gt. @bsiz then
   set bsiz = @xdim
endif
if @ydim .gt. @bsiz then
   set bsiz = @ydim
endif
if @zdim .gt. @bsiz then
   set bsiz = @zdim
endif
open read unit 10 card name crystal_image.str
crystal defi cubic @bsiz @bsiz @bsiz 90. 90. 90.
crystal build nope 0
image byres xcen 0.0 ycen 0.0 zcen 0.0 sele all end

!============================================================
! Define Force Field
!============================================================
nbonds atom ewald pmewald kappa 0.43 -
   fftx 32 ffty 32 fftz 32 order 4 -
   cutnb 14.0  ctofnb 12.0 ctonnb 8.0 -
   lrc vdw vswitch inbfrq -1 imgfrq -1

!============================================================
! Define Constraints
!============================================================

! Fix all bond distances for bonds including at least one H atom
!SHAKE BONH TOLErance 1.0e-8 PARAMeter


!============================================================
! Charge Model
!============================================================

open unit 11 card read name water.kmdcm
open unit 12 card read name water.kern
!open unit 15 write card name dcm.xyz
DCM KERN 12 IUDCM 11 TSHIFT !XYZ 15

!============================================================
! Short minimization of atoms
!============================================================

label MINILOOP
if @min .eq. 0 then
!! Strucuture optimization
mini sd nstep 20 nprint 1000
! Save optimized structure
open write unit 10 card name @base/water.2000.mini.pdb
write coor unit 10 pdb
CLOSE UNIT 10
ENDIF
!============================================================

!============================================================
! Heating Simulation
!============================================================

OPEN WRITE UNIT 31 CARD NAME @base/water.2000.heat.res      ! Restart file
OPEN WRITE UNIT 32 FILE NAME @base/water.2000.heat.dcd      ! Coordinates file

set nstep = 10

DYNA STRT VERL NSTE @nstep TIME @dt -
   INBFRQ -1 IMGFRQ 20 IHBFRQ 0 -
   IPRFRQ 500 IHTFRQ 2000 NTRFRQ 500 -
   IUNREA -1 IUNWRI 31 IUNCRD 32 IUNVEL -1  -
   NPRINT 1000 NSAVC 1000 -
   FIRSTT 100.0 FINALT @temp TEMINC 10.0 -
   TWINDH 10.0 TWINDL -10.0 -
   IASORS 1 IASVEL 1 ICHECW 0


OPEN UNIT 1 WRITE CARD NAME water.2000.heat.pdb
WRITE COOR PDB UNIT 1
CLOSE UNIT 1

OPEN UNIT 1 WRITE CARD NAME water.2000.heat.crd
WRITE COOR CARD UNIT 1
CLOSE UNIT 1


!============================================================
! Equilibration Simulation
!============================================================
label EQUILLOOP
if @equi .eq. 0 then

OPEN READ  UNIT 30 CARD NAME water.2000.heat.res      ! Restart file
OPEN WRITE UNIT 31 CARD NAME water.2000.equi.res      ! Restart file
OPEN WRITE UNIT 32 FILE NAME water.2000.equi.dcd      ! Coordinates file

set nstep = 10
set dt = 
set temp = 

scalar mass stat
calc Pmass = int ( ?stot  /  50.0 )

DYNA RESTRT CPT LEAP NSTE @nstep TIME @dt -
   INBFRQ -1 IMGFRQ 50 IHBFRQ 0 -
   IUNREA 30 IUNWRI 31 IUNCRD 32 IUNVEL -1 -
   IHTFRQ 0 IEQFRQ 2000 NTRFRQ 2000 -
   NPRINT 10000 IPRFRQ 10000 NSAVC 10000  -
   PCONSTANT PREF   1.0  PMASS @Pmass  PGAMMA   20.0 -
   HOOVER    REFT @temp  TMASS 2000.0  TBATH   @temp

OPEN UNIT 1 WRITE CARD NAME water.2000.equi.pdb
WRITE COOR PDB UNIT 1
CLOSE UNIT 1

OPEN UNIT 1 WRITE CARD NAME water.2000.equi.crd
WRITE COOR CARD UNIT 1
CLOSE UNIT 1

!============================================================
! Dynamics (Production) Simulation
!============================================================

label DYNALOOP
if @dyna .eq. 0 then

set nstep 10
set dt 
set temp 

if @n .eq. 0 then
  set m @n
  open read unit 33 card name equi.res     ! Restart file
  open write unit 34 card name water.2000.dyna.@n.res ! Restart file
  open write unit 35 file name water.2000.dyna.@n.dcd ! Coordinates file
else
  calc m @n-1
  open read unit 33 card name water.2000.dyna.@m.res
  open write unit 34 card name water.2000.@n.res
  open write unit 35 file name water.2000.dyna.@n.dcd
endif

DYNA RESTRT CPT LEAP NSTE @nstep TIME @dt -
   INBFRQ -1 IMGFRQ 50 IHBFRQ 50 -
   IUNREA 30 IUNWRI 31 IUNCRD 32 IUNVEL -1 -
   IHTFRQ 2000 IEQFRQ 2000 NTRFRQ 2000 -
   NPRINT 1000 IPRFRQ 1000  -
   PCONSTANT PREF   1.0  PMASS @Pmass  PGAMMA   20.0 -
   HOOVER    REFT @temp  TMASS 2000.0  TBATH   @temp

open unit 1 write card name water.2000.dyna.@n.crd
write coor card unit 1
close unit 1

open write unit 10 card name water.2000.dyna.@n.pdb
write coor unit 10 pdb

close unit 33
close unit 34
close unit 35

increase n by 1
if n lt 10 goto DYNALOOP

endif
!============================================================

STOP